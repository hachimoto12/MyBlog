<!DOCTYPE html>
<html lang="ja">
    <head>
        <!-- icon -->
        <link rel="shortcut icon" href="https://hachimoto12.com/theme/images/favicon.ico"/>
        <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://hachimoto12.com/theme/images/icon180.png">
        <link rel="icon" type="image/png" href="https://hachimoto12.com/theme/images/icon256.png">        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-150670088-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-150670088-1');
        </script>        <meta charset=utf-8>
        <meta name="viewport" content="width=device-width, initial-scale=1.0,minimum-scale=1.0" />
        <!-- ogp -->
        <meta property="og:type" content="website"/>        <meta property="og:title" content="Unrealで雨が降った後に波紋を出す | 鉢本　一二のブログ"/>
        <meta property="og:url" content="https://hachimoto12.com/unreal_particle_rain_repple.html" />        <meta property="og:site_name" content="鉢本　一二のブログ" />
        <!--
        <title>鉢本　一二のブログ</title>
        -->        <title>Unrealで雨が降った後に波紋を出す | 鉢本　一二のブログ</title>        <link rel="stylesheet" type="text/css" href="https://hachimoto12.com/theme/css/stylesheet.css" /><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://hachimoto12.com/theme/css/pygment.css" />
<style type="text/css">
.content {
    margin: 30px;
}
.title {
    margin-bottom: 2em;
    text-align: left;
}
.info {
    margin: 2em auto;
}
.section {
    margin-top: 2em;
}
.section h2, .section h3 {
    margin: 2em auto;
    padding: 0.7em 0 0.7em 1em;
}
.section h2 {
    border-left: 10px solid rgb(66, 66, 66);
    border-bottom: 2px solid rgb(66, 66, 66);
}
.section h3 {
    border-left: 5px solid rgb(66, 66, 66);
}
.section ul, .section ol {
    margin: 0.7em 1em;
}
.section li {
    margin: 0.7em auto;
}
.section dl {
    margin: 1em auto;
}
.section dd {
    margin-left: 1em;
}
.highlight pre {
    margin: 2em auto;
    padding: 1em auto;
    font-family: "Source Han Code JP", sans-serif;
    font-size: 0.8em;
    line-height: 1.5em;
    overflow: auto;
}
.note {
    border: 2px solid rgb(66, 66, 66);
    border-radius: 5px;
}
.warning {
    /*border: 2px solid rgb(66, 66, 66);*/
    border: 2px solid rgb(200, 60, 50);
    border-radius: 5px;
}
.admonition {
    margin: 2em auto;
    padding: 0.7em;
}
.admonition-title {
    font-weight: bold;
    font-size: 1.5em;
}
.warning .admonition-title {
    color: rgb(200, 60, 50);
}
</style>    </head>
    <body>
        <div class="wrapper">
            <header class="header">
                <h1 class="header-title" ontouchstart="">
                    <a href="https://hachimoto12.com/">
                        <strong>鉢本　一二のブログ</strong>
                    </a>
                </h1>
            </header>
            <nav class="navigation" ontouchstart="">
                <ul>
                    <li>
                       <a href="https://hachimoto12.com/">
                           Top
                       </a>
                    </li>
                    <li>
                        <a href="https://hachimoto12.com/archives.html">
                            アーカイブ
                        </a>
                    </li>
                    <li>
                        <a href="/categories.html">
                            カテゴリ
                        </a>
                    </li>
                    <li>
                        <a href="https://hachimoto12.com/tags.html">
                            タグ
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="left-area"></div>
            <main class="content" ontouchstart=""><h1 class="title">Unrealで雨が降った後に波紋を出す</h1>
<div class="info">
    <div>
        作成日 : <time datetime="2020-01-25T00:00:00+09:00">2020/01/25</time>
    </div>
    <div>
        更新日 : <time datetime="2020-01-25T00:00:00+09:00">2020/01/25</time>
    </div>
    <div class="category-item">
        <i class="material-icons">folder</i>
        ：        <a href="https://hachimoto12.com/category/3d.html" class="category">
            3D
        </a>    </div>
        <div class="tag-list">
        <i class="material-icons">
            local_offer
        </i>
        ：        <a href="/tag/unreal.html" class="tag">Unreal</a>,<a href="/tag/how_to_make.html" class="tag">作り方</a>    </div>
</div><p>ゲームエンジンを使って雨を降らせるというのを行いたいと思い、google先生で調べたところ <a href="http://nn-hokuson.hatenablog.com/entry/2019/07/05/090946">おもちゃラボさんの【Unity】広重のような雨のエフェクトを作る</a>が見つかり、雨の感じが自分好みだった。</p>
<p>このような雨の降らせ方をUnrealでもできないかと、素人ながらに試行錯誤し、それらしく作れたのでその時の手順をメモした。</p>
<h2>環境</h2>
<ul>
<li>Unreal Engin: v4.23.1</li>
</ul>
<h2>手順</h2>
<h3>プロジェクトの作成</h3>
<p>とりあえず、プロジェクトを作成。<br>
プロジェクト名は、<code>Rain_Project</code>とする。</p>
<h3>床の設定</h3>
<p>デフォルトの床のマテリアルを変更する。<br>
<code>Floor</code>を選択し、マテリアルは<code>M_Floor_01</code>にする。<br>
<img alt="床のマテリアルを設定" src="images/2020_01_25_32.png" title="床のマテリアルを設定">  </p>
<h3>雨マテリアルを作成</h3>
<p>テクスチャはこのような感じを作成。<br>
名前は、とりあえず<code>T_Rain</code>という名前を付けて、Unrealにインポート。<br>
<img alt="雨のテクスチャ" src="images/2020_01_25_01.png" title="雨のテクスチャ">  </p>
<p>次に雨のマテリアルを作成する。<br>
マテリアルの名前は、<code>M_Rain</code>とした。<br>
<code>M_Rain</code>を開くと、メインマテリアルが１つある状態となっている。
<img alt="雨のマテリアル" src="images/2020_01_25_02.png" title="雨のマテリアル">  </p>
<p>メインマテリアルの設定を変更する。</p>
<p>詳細タブにある</p>
<ul>
<li>Material -&gt; Blend Mode</li>
</ul>
<p>の<code>Opacue</code>を<code>Translucent</code>に変更。<br>
<img alt="Translucentに変更" src="images/2020_01_25_03.png" title="Translucentに変更">  </p>
<p>メインマテリアルの詳細に関する設定はこれで終了。<br>
次に、<code>T_Rain</code>をマテリアルに適用するため<code>Texture Sample</code>ノードを追加。
<img alt="Texture Sampleノードを追加" src="images/2020_01_25_04.png" title="Texture Sampleノードを追加">  </p>
<p><code>Texture Sample</code>ノードに<code>T_Rain</code>を適用する。</p>
<p><code>Texutre Sample</code>ノードの詳細タブにある<code>Material Expression Texture Base</code>の<code>Texture</code>の項目で<code>T_Rain</code>を設定する。<br>
<img alt="T_Rainを設定" src="images/2020_01_25_05.png" title="T_Rainを設定">  </p>
<p>これで<code>Texture Sample</code>ノードの詳細に関する設定は終了。<br>
次にノードを繋げていく。  </p>
<ul>
<li><code>Texture Sample</code>ノードの<code>RGB</code> -&gt; メインマテリアルの<code>エミッシブルカラー</code></li>
<li><code>Texture Sample</code>ノードの<code>A</code> -&gt; メインマテリアルの<code>オパシティ</code></li>
</ul>
<p>それぞれに接続する。<br>
<img alt="雨のマテリアル完成系" src="images/2020_01_25_06.png" title="雨マテリアルの完成系"><br>
<img alt="雨のマテリアルの結果" src="images/2020_01_25_07.png" title="雨マテリアルの結果">  </p>
<h3>波紋マテリアルを作成</h3>
<p>波紋のテクスチャを用意。<br>
テクスチャ名は、とりあえず<code>T_Repple</code>という名前にした。<br>
<img alt="波紋のテクスチャ" src="images/2020_01_25_08.png" title="波紋のテクスチャ">  </p>
<p>波紋のマテリアルを作成する。<br>
マテリアルの名前は、<code>M_Repple</code>にした。<br>
エミッシブルカラーは<code>Texture Sample</code>とメインマテリアルをそのまま繋ぐが、オパシティは <code>Texture Sample</code> と <code>Particle Color</code> を合わせて使用する。</p>
<ul>
<li><code>Texture Sample</code>ノードの<code>Texture</code>の項目は、<code>T_Repple</code>を設定  </li>
<li><code>オパシティ</code>をパーティクル側で調整出来るようにする。<ol>
<li><code>Particle Color</code>を追加  </li>
<li><code>Multiply</code>を追加  </li>
<li><code>Texture Sample</code>の<code>A</code>と<code>Particle Color</code>の白を<code>Multiple</code>の<code>A</code>と<code>B</code>に繋げる。<br>
２つは<code>A</code>, <code>B</code>どちらにつないでも問題ない。  </li>
<li><code>Multiply</code>の出力をメインの<code>オパシティ</code>に繋げる。</li>
</ol>
</li>
</ul>
<p>以下がその完成系。<br>
<img alt="波紋のマテリアル完成系" src="images/2020_01_25_09.png" title="波紋マテリアルの完成系"><br>
<img alt="波紋のマテリアルの結果" src="images/2020_01_25_10.png" title="波紋マテリアルの結果">  </p>
<h3>雨を降らせる</h3>
<p>雨と波紋それぞれのマテリアルを用意できたので、実際に雨を降らせる。  </p>
<p>まず、パーティクルを作成する。<br>
パーティクルの名前は、<code>Rain_System</code>という名前を付けた。<br>
作成した<code>Rain_System</code>を開くと次のような画面がでてくる。<br>
<img alt="作成したパーティクルの画面" src="images/2020_01_25_11.png" title="作成したパーティクルの画面">  </p>
<p><code>Required</code>や<code>Spawn</code>というモジュールがあるが、初期のモジュールでは必要なものが無かったり、使わないモジュールがあったりしており、またそれぞれのモジュールの設定などもあるので、なるべく簡潔に説明する。</p>
<p>まず、使ったモジュールは以下である。<br>
<img alt="Rain_Emitterの必要なモジュール" src="images/2020_01_25_12.png" title="Rain_Emitterの必要なモジュール">  </p>
<p>番号順に説明する。</p>
<ol>
<li>ここでは、エミッタの名前を変更する。<br>
<code>Rain Emitter</code>という名前にする。<br>
<img alt="エミッタの名前を変更" src="images/2020_01_25_13.png" title="エミッタの名前を変更"></li>
<li><code>Required</code>モジュール。<br>
マテリアルを設定する。<code>M_Rain</code>を設定。<br>
<img alt="マテリアルを変更" src="images/2020_01_25_14.png" title="マテリアルを変更"></li>
<li><code>Spawn</code>モジュール。<br>
発生させるパーティクルの数を設定する。数は、<code>5000</code>にする。<br>
<img alt="Constantの値を設定" src="images/2020_01_25_15.png" title="Constantの値を設定"></li>
<li><code>Event Generator</code>モジュール。<br>
パーティクル衝突時に、イベントを生成するようにする。<br>
このモジュールは、この後説明する<code>波紋を表示</code>のために必要になってくる。  <ul>
<li>最初に<code>+</code>ボタンでイベントを1つ追加する。</li>
<li><code>Type</code>を<code>コリジョン</code>に設定する。
イベントの発生条件を床と雨が衝突したときにイベントを発生させるため。</li>
<li><code>CustomName</code>を<code>onKilledRain</code>と入力。<br>
通知するイベント名は、まぁ雨がkillした後のイベントということで。<br>
<img alt="Constantの値を設定" src="images/2020_01_25_16.png" title="Constantの値を設定"></li>
</ul>
</li>
<li><code>Lifetime</code>モジュール。<br>
雨のライフタイムを設定。<ul>
<li><code>min</code>は<code>0.0</code>を設定</li>
<li><code>max</code>は<code>0.3</code>を設定<br>
<img alt="Lifetimeの設定" src="images/2020_01_25_17.png" title="Lifetimeの設定"></li>
</ul>
</li>
<li><code>Initial Size</code>モジュール。<br>
特に何もしない。</li>
<li><code>Initial Location</code>モジュール。<br>
雨を降らせる範囲を設定。<ul>
<li><code>Distribution</code>は<code>Distribution Vector Uniform</code>にする。</li>
<li><code>max</code>は、x=<code>500</code>, y=<code>500</code>, z=<code>500</code>を設定</li>
<li><code>min</code>は、x=<code>-500</code>, y=<code>-500</code>, z=<code>-0.1</code>を設定<br>
<img alt="パーティクルの範囲設定" src="images/2020_01_25_18.png" title="パーティクルの範囲設定"></li>
</ul>
</li>
<li><code>Const Acceleration</code>モジュール。<br>
雨が降る速度を変更。<br>
パーティクルを下に移動させるため、マイナスの数字を入力する。<code>z</code>に<code>-5000</code>を入力。<br>
<img alt="雨の降るスピードを設定" src="images/2020_01_25_19.png" title="雨の降るスピードを設定"></li>
<li><code>Actor Collision</code>モジュール。<br>
これは特になにもしない。</li>
<li><code>Lock Axis</code>モジュール。これを設定しないと、カメラの向きを変えたときなど雨の降り方がおかしなことになる。<br>
<code>Lock Axis Flags</code>の設定を<code>Rotate Z</code>を指定する。<br>
<img alt="回転を抑制" src="images/2020_01_25_20.png" title="回転を抑制"></li>
</ol>
<p>ここで、一旦設定したパーティクル<code>Rain_System</code>をビューポートに設置する。 <br>
<code>Rain_System</code>の位置は、xyzともに <code>0</code> にした。次の図のように雨が降ってくるようになった。<br>
<img alt="ビューポートに設置" src="images/2020_01_25_21.png" title="ビューポートに設置"></p>
<h3>波紋を表示</h3>
<p>波紋の表示のタイミングは、雨が降る -&gt; 床に当たる -&gt; 波紋を表示、というふうにしたい。<br>
エミッタは左から右に実行されるので、<code>Rain Emitter</code>の右側に波紋用のエミッタを作成する。  </p>
<p><img alt="波紋用のエミッタを作成" src="images/2020_01_25_22.png" title="波紋用のエミッタを作成"></p>
<p>波紋を表示させるために、使ったモジュールは以下である。<br>
<img alt="必要なモジュール" src="images/2020_01_25_23.png" title="必要なモジュール">  </p>
<p>番号順に説明する。  </p>
<ol>
<li><code>Required</code>モジュール。<br>
ここでは、マテリアルを<code>M_Repple</code>に変更する。<br>
<img alt="マテリアルを変更" src="images/2020_01_25_24.png" title="マテリアルを変更">  </li>
<li><code>Spawn</code>モジュール。<br>
このモジュールで、波紋をスポーンしない。なので、数は<code>0</code>にする。<br>
<img alt="Constantの値を設定" src="images/2020_01_25_25.png" title="Constantの値を設定"></li>
<li><code>EventReceiver Spawn</code>モジュール。<br>
雨の<code>Event Generator</code>モジュールが発行したイベントを受け取り、パーティクルをスポーンする。<ul>
<li><code>Constant</code>に１を設定。<br>
なぜ1かというと、雨1粒につき波紋を1つだけスポーンさせたいため</li>
<li><code>Source</code><br>
ここでは、上記の雨で設定した<code>Event Generator</code>モジュールの値と同じものを入力する。<ul>
<li><code>Event Generator Type</code>は、<code>コリジョン</code>を設定</li>
<li><code>Event Name</code>は、<code>onKilledRain</code>を入力<br>
<img alt="Constantの値を設定" src="images/2020_01_25_26.png" title="Constantの値を設定"></li>
</ul>
</li>
</ul>
</li>
<li><code>Lifetime</code>モジュール<br>
波紋のライフタイムを設定。<ul>
<li><code>min</code>は<code>0.0</code>を設定</li>
<li><code>max</code>は<code>2.0</code>を設定<br>
<img alt="Lifetimeの設定" src="images/2020_01_25_27.png" title="Lifetimeの設定"></li>
</ul>
</li>
<li><code>Initial Location</code>モジュール<br>
波紋を表示させる位置について、<code>XY</code>について設定はしない。<br>
ただし、<code>Z</code>が<code>0</code>のままでは、床の上部分と座標が被り波紋の線がはっきりとしない。<br>
波紋を表示させる高さを変える。一応床より少し上にする。  <br>
<code>Max</code>と<code>Min</code>の<code>Z</code>に<code>0.01</code>を入力。<br>
<img alt="高さの設定" src="images/2020_01_25_28.png" title="高さの設定">  </li>
<li><code>Initial Size</code>モジュール<br>
特に何もしない。</li>
<li><code>Color Over Life</code>モジュール<br>
徐々に波紋が消えるように色を設定する。<br>
基本、追加時の初期設定で徐々に消えるようになっているので、特に何もしない。</li>
<li><code>Size By Life</code>モジュール。<br>
波紋が徐々に広がるようにするために使用。<br>
<code>Points</code> -&gt; <code>0</code> -&gt; <code>Out Val</code> の<code>X</code>, <code>Y</code>, <code>Z</code>に<code>0</code>を入力。  <br>
<img alt="Size By Lifeの設定" src="images/2020_01_25_29.png" title="Size By Lifeの設定">  </li>
<li><code>Lock Axis</code>モジュール<br>
これを設定しないと、波紋が縦に表示される。<br>
なので、<code>Lock Axis Flags</code>を<code>Z</code>にする。<br>
<img alt="Lock Axis Flagsの設定" src="images/2020_01_25_30.png" title="SLock Axis Flagsの設定">  </li>
</ol>
<p>すべての設定は完了したので、ビューポートで確認。<br>
<img alt="ビューポート確認" src="images/2020_01_25_31.png" title="ビューポート確認">  </p><p>
<br>
<br>
<br>
</p>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://bo-ben-yi-er-noburogu-1.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>            </main>
            <div class="right-area"></div>
            <footer class="footer">
                <span class="copyright">
                    (c) 2019 鉢本　一二
                </span>
            </footer>
        </div>        <script id="dsq-count-scr" src="//bo-ben-yi-er-noburogu-1.disqus.com/count.js" async></script>    </body>
</html>